Code added by Zhengyang Liu.
